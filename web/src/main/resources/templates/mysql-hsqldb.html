<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3"
	lang="en">
<head>
<meta charset="UTF-8" />
<title th:text="${title==null} ? 'FashionProFinder' : #{${title}} + ':FashionProFinder'">FashionProFinder</title>
<th:block th:fragment="headContent">
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" />
<link rel="stylesheet" href="../static/css/fpf.css" th:href="@{/css/fpf.css}" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
</th:block>
<th:block th:fragment="googleapis">
<script>
/*<![CDATA[*/
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-60869220-1', 'auto');
  ga('send', 'pageview');
  /*]]>*/
</script>
</th:block>
</head>
<!--
comments: 
IE11
-->
<body>
<div class="container-fluid">
<div class="row">
<form action="#">
<div class="col-md-4">
	<textarea id="mysql" class="form-control" cols="20"s></textarea>
</div>
<div class="col-md-1">
	<button type="submit" class="btn btn-primary form-control">Convert</button>
</div>
<div class="col-md-7">
	<textarea id="hsqldb" class="form-control" cols="20"></textarea>
</div>
</form>
</div>
</div>
<script type="text/javascript">
	$('form').on('submit', function(e){
		e.preventDefault();
		var convertion;
		$.each($('#mysql').val().split('\n'), function(index, value){
			value = $.trim(value);
			if(value.substr(0,2)!='--' && value.substr(0,3)!='SET' && value.substr(0,3)!='USE'){
				value = value.replace('IF NOT EXISTS ', '').replace(/`/g,'');
				if(value.substr(0,14)=='CREATE SCHEMA '){
					value = value.substr(0, value.indexOf(' ', 14)) + ' AUTHORIZATION DBA;';
				}
				if(convertion){
					convertion = convertion + value + ' ';
				}else
					convertion =  value + ' ';
			}
		});
		$('#hsqldb').val('');
		$.each(convertion.split(';'), function(index, value){
			value = $.trim(value).replace('AUTO_INCREMENT', 'GENERATED BY DEFAULT AS IDENTITY')
									.replace('NOT NULL DEFAULT CURRENT_TIMESTAMP','DEFAULT CURRENT_TIMESTAMP NOT NULL')
									.replace('NOT NULL DEFAULT', 'DEFAULT')
									.replace(' NULL DEFAULT NULL', '');

			value = replaceInt(value, 'INT', 'integer');
			value = replaceInt(value, 'TINYINT', 'integer');

			i = value.indexOf('ENGINE');
			if(i>0)
				value = value.substr(0, i);
			$('#hsqldb').val($('#hsqldb').val()+value+'\n');
		});
		function replaceInt(sql, toReplace, replacement){
			var doWhile;
			do{

				var index = sql.indexOf(' '+toReplace+' ');
				var withBrackets;
				if(index>0){
					withBrackets = false;
				}else{
					withBrackets = true;
					index = sql.indexOf(' '+toReplace+'(');
				}

				if(index>0){
					doWhile = true

					var i = sql.indexOf(',', ++index);

					var ss;
					if(i>0){
						ss = sql.substr(index, i-index);
					}else{
						ss = sql.substr(index);
					}

					var tmp = ss.indexOf('UNSIGNED')
					if(tmp>0){
						i = index + tmp + 8;
					}else{
						i = withBrackets ? sql.indexOf(')', index) + 1 : index + 3;
					}

					sql = sql.substr(0, index) + replacement + sql.substr(i);
				}else{
					doWhile = false;
				}

			}while(doWhile);

			return sql;
		}
	});
</script>
</body>
</html>