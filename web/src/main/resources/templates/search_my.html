<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
<title>Fashion PRO Finder</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width" />
<link rel="stylesheet" type="text/css" href="../static/css/jk.css" th:href="@{/css/jk.css}" />
<script src="../static/js/jquery-2.1.3.min.js" th:src="@{/js/jquery-2.1.3.min.js}"></script>
</head>
<body>
	<div id="header" th:replace="fragments/header :: pageHeader">Header</div>
	<div id="menuDiv" th:replace="fragments/menu :: menu">Menu</div>
	<div id="contents">
		<div class="search">
			<div class="search_contaner">
				<form id="searchForm" action="#">
					<input type="text" id="keywords" placeholder="Search..." th:placeholder="#{search}+'...'" required="required" />
					<input type="text" id="location" placeholder="location..." th:placeholder="#{location}+'...'" th:value="${location}" />
					<input type="hidden" id="page" />
					<button type="submit" th:text="#{search}">Search</button>
				</form>
				<p id="abc" class="search">
					<span>Fashion pro finder search by :</span> <a href="#">All</a> <a href="#">a</a> <a
						href="#">b</a> <a href="#">c</a> <a href="#">d</a> <a href="#">e</a>
					<a href="#">f</a> <a href="#">g</a> <a href="#">h</a> <a href="#">j</a>
					<a href="#">k</a> <a href="#">l</a> <a href="#">m</a> <a href="#">n</a>
					<a href="#">o</a> <a href="#">p</a> <a href="#">q</a> <a href="#">r</a>
					<a href="#">s</a> <a href="#">t</a> <a href="#">u</a> <a href="#">v</a>
					<a href="#">w</a> <a href="#">x</a> <a href="#">y</a> <a href="#">z</a>
				</p>
				<p id="srch_count"></p>
				<ul id="srch_rslt"></ul>
			</div>
			<script type="text/javascript">
			/*<![CDATA[*/
			var page;
			$(function(){
				$('#searchForm').on('submit', function(e){

					e.preventDefault();
					var keywords = $('#keywords').val();
					if(keywords){
						keywords = $.trim(keywords);
						if(keywords){
							var data = {};
							data['keywords'] = keywords;

							var location = $('#location').val();
							if(location){
								location = $.trim(location);
								if(location.length!=0){
									data['location'] = location;
								}
							}

							var page = $('#page').val();
							if(page){
								data['page'] = page;
							}

							$.ajax({
								url : '/careerjet',
								type : 'POST',
								data : data ,

								success : function(data) {
									$('#jobs').remove();
									$('#srch_rslt> li').remove();
									switch(data.type){
									case "JOBS":
										jobs(data);
										break;
									case "LOCATIONS":
										locations(data.solveLocations);
										break;
									case "ERROR":
										alert(data);
										break;
									default:
										alert(data);
									}
								}
							});
						}
					};
				});
				function jobs(data){
					jobsCount(data.hits);
					jobsPages(data.pages);
					jobsResults(data.jobs);
				}
				function jobsCount(hits){
					if(hits !== undefined){
						$('#srch_count').attr('name', 'count').text(hits+" results");
					}
				}
				function jobsPages(pages){
					if(pages !== undefined){
						if(pages > 1){
							for(var i=1; i <= pages; i++){
								var tag = $('#srch_rslt').attr('name', 'pages');
								var li = $('<li></li>').append( '<a href="#">'+i+'</a>').appendTo(tag);
								var page = $('#page').val();
								if((page && page==i) || (!page && i==1)){
									li.addClass("selected");
								}
							}
							$('#page').val('');
							$('ul[name="pages"] a').on('click', function(e){
								e.preventDefault();
								$('#page').val(this.text);
								$('#searchForm').submit();
							});
						}
					}
				}
				function jobsResults(jobs){
					if(jobs){
						var length = jobs.length;
						if(length>0){
							var list = $('<ul></ul>').attr('id', 'jobs').insertAfter('#srch_rslt');

							$.each(jobs, function( index, value) {

								var li = $('<li></li>').appendTo(list);
								li.append('<a href="'+value.url+'" target="_blank">'+(value.company ? value.company : 'Go to site')+'</a>');
								var sList = $('<ul></ul>').appendTo(li);
								if(value.title){
									$('<li></li>').appendTo(sList).append('<span>Title: </span>'+value.title);
								}
								if(value.salary){
									$('<li></li>').appendTo(sList).append('<span>Salary: </span>'+value.salary);
								}
								if(value.salary_currency_code){
									$('<li></li>').appendTo(sList).append('<span>Salary currency code: </span>'+value.salary_currency_code);
								}
								if(value.locations){
									$('<li></li>').appendTo(sList).append('<span>Locations: </span>'+value.locations);
								}
								if(value.description){
									$('<li></li>').appendTo(sList).append('<span>Description: </span>'+value.description);
								}
								var site = value.site;
								if(site){
									if(site.substr(0,3) != 'http'){
										site = 'http://'+site;
									}
									$('<li></li>').appendTo(sList).append('<span>Site: </span><a href="'+site+'" target="_blank">'+value.site+'</a>');
								}
							});
						}
					}
				}
				function locations(solveLocations){
					if(solveLocations && solveLocations.length > 0){
						$('#srch_count').attr('name', 'solveLocations').text('Select Location');
						var loc = $('#srch_rslt').attr('name', 'locations');
						$.each(solveLocations, function( index, value) {
							$('<li></li>').appendTo(loc).append('<a href="#">'+value.name+'</a>');
						});
						$('ul[name="locations"] a').on('click', function(e){
							e.preventDefault();
							$('#location').val(this.text);
							$('#searchForm').submit();
						});
					}else
						alert('Impossible to find a location');
				}
			});
			$('.search a').on('click', function(e) {

				e.preventDefault();
				$('.active').removeClass('active');
				$(this).addClass('active');
				$('#srch_count').empty();
				$('#srch_rslt> li').remove();
				$.ajax({
					url : '/search/' + this.text,
					type : 'POST',

					success : function(data) {
						$.each(data, function(index, value) {
							if (value.categoryId == 0) {
								$('#srch_count').text( value.categoryName);
							} else {
								var caregories = $('#srch_rslt').attr('name', 'categories');
								$('<li></li>').append( '<a href="#">'+value.categoryName+"</a>").appendTo(caregories);
							}
						});
						$('ul[name="categories"] a').on('click', function(e){
							e.preventDefault();
							$('#keywords').val(this.text);
							$('#searchForm').submit();
						});
					}
				});
			});
			/*]]>*/
			</script>
		</div>
	</div>
	<div th:replace="fragments/footer :: footer">Footer</div>
</body>
</html>