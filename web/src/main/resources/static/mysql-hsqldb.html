<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3"
	lang="en">
<head>
<meta charset="UTF-8" />
<title>MySQL to HSQLDB Converter</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" />
<link rel="stylesheet" href="/css/fpf.css" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script>/*<![CDATA[*/(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-60869220-1', 'auto');ga('send', 'pageview');/*]]>*/</script>
</head>
<!--
comments: 
IE11
-->
<body>
<div class="container-fluid">
<div class="row">
<h3>MySQL to HSQLDB Converter</h3>
<form action="#">
<div class="col-md-4">
<div class="panel panel-default">
 <div class="panel-heading">MySQL : Generate separate CREATE INDEX statements</div>
  <div class="panel-body">
	<textarea id="mysql" class="form-control" rows="20"></textarea>
</div>
</div>
</div>
<div class="col-md-1">
	<button type="submit" class="btn btn-primary form-control">to HSQLDB</button>
</div>
<div class="col-md-7">
<div class="panel panel-default">
<div class="panel-heading">HSQLDB : Result</div>
<div class="panel-body">
	<textarea id="hsqldb" class="form-control" rows="20"></textarea>
</div>
</div>
</div>
</form>
</div>
<div><script async="async" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:inline-block;width:250px;height:250px" data-ad-client="ca-pub-1240215757349321"  data-ad-slot="7690894295"></ins><ins class="adsbygoogle" style="display:inline-block;width:250px;height:300px" data-ad-client="ca-pub-1240215757349321" data-ad-slot="3260694695"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});(adsbygoogle = window.adsbygoogle || []).push({});</script></div>
</div>
<script type="text/javascript">
	$('form').on('submit', function(e){
		e.preventDefault();
		var convertion;
		var isComment = false;
		$.each($('#mysql').val().split('\n'), function(index, value){
			value = $.trim(value.replace(/\s+/g, ' '));
			if(value && value.substr(0,2)!='--' && value.substr(0,3)!='SET' && value.substr(0,3)!='USE' && value.substr(0,5)!='DROP '){
				var startIndex = value.indexOf('/*');
				if(startIndex>=0){
					isComment = true;
				}
				var stopIndex = value.indexOf('*/')+2;
				if(stopIndex>1){
					if(isComment){
						isComment = false;
						value = value.substr(0, startIndex) + value.substr(stopIndex);
					}else
						value = value.substr(stopIndex);
				}
				if(isComment && startIndex>0){
					value = value.substr(0, startIndex);
				}
				if(!isComment || (isComment && startIndex>0)){
					value = value.replace('IF EXISTS ', '').replace('IF NOT EXISTS ', '').replace(/`/g,'');
					var count =14;
					if(value.substr(0,count)=='CREATE SCHEMA ' || value.substr(0, (count=count+2))=='CREATE DATABASE '){
						var legnth = value.length;
						var c = value.indexOf(' ', count) - count;
						var x = value.substr(count);
						value = 'CREATE SCHEMA ' + value.substr(count, c) + ' AUTHORIZATION DBA;';
					}
					if(convertion){
						convertion = convertion + value + ' ';
					}else{
						convertion =  value + ' ';
					}
				}
			}
		});
		$('#hsqldb').val('');
		if(convertion)
		$.each(convertion.split(';'), function(index, value){
			value = $.trim(value.replace(/\s+/g, ' '));
			if(value){
				value = value.replace('AUTO_INCREMENT', 'GENERATED BY DEFAULT AS IDENTITY')
									.replace('NOT NULL DEFAULT CURRENT_TIMESTAMP','DEFAULT CURRENT_TIMESTAMP NOT NULL')
									.replace('NOT NULL DEFAULT', 'DEFAULT')
									.replace(' NULL DEFAULT NULL', '');

				value = replaceInt(value, 'int', 'integer');
				value = replaceInt(value, 'tinyint', 'integer');

				i = value.toLowerCase().indexOf('engine');
				if(i>0){
					value = value.substr(0, i);
				}
				$('#hsqldb').val($('#hsqldb').val()+value+'\n');
			}
		});
		function replaceInt(sql, toReplace, replacement){
			var doWhile;
			do{

				var index = sql.toLowerCase().indexOf(' '+toReplace+' ');
				var withBrackets;
				if(index>0){
					withBrackets = false;
				}else{
					withBrackets = true;
					index = sql.toLowerCase().indexOf(' '+toReplace+'(');
				}

				if(index>0){
					doWhile = true

					var i = sql.indexOf(',', ++index);

					var ss;
					if(i>0){
						ss = sql.substr(index, i-index);
					}else{
						ss = sql.substr(index);
					}

					var tmp = ss.toLowerCase().indexOf('unsigned')
					if(tmp>0){
						i = index + tmp + 8;
					}else{
						i = withBrackets ? sql.indexOf(')', index) + 1 : index + 3;
					}

					sql = sql.substr(0, index) + replacement + sql.substr(i);
				}else{
					doWhile = false;
				}

			}while(doWhile);

			return sql;
		}
	});
</script>
</body>
</html>